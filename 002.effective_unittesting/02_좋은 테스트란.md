# 좋은 테스트란?

>   *   무엇이 '좋은' 테스트를 만드는가?
>   *   테스트를 대하는 태도
>   *   신뢰할 수 있는 테스트의 중요성



좋은 테스트에 대한 고려 사항

1.  가독성과 유지 보수성
2.  적절히 구조화 되어 있는가?
3.  테스트가 무엇을 검사하는가?
4.  테스트는 안정적이고 반복 가능한가?
5.  테스트가 테스트 더블을 잘 활용하는가?



## 2.1 읽기 쉬운 코드가 유지보수도 쉽다

*   읽기 어려운 코드일 수록 결함 수가 많다.
*   일기 어려운 콛는 검증하기도 어렵고, 결과적으로 테스트를 조금만 작성하는 사태로까지 이어진다.



## 2.2 구조화가 잘 되어 있다면 이해하기 쉽다

*   코드를 보고 이해할 수 있는 구조가 필요하다.
*   우리 두뇌와 사고 모델이 지지고 볶을 수 있을 정도로 정리된 구조라야 한다.
*   코드 동작 방식을 구체적으로 보여주는 테스트 코드를 정독하면 도움이 된다.
*   결국 읽기 쉽고, 찾기 쉽고, 이해하기 쉽도록 한 가지 기능에 충실한 테스트가 필요한 것이다.
    *   현재 작업과 관련된 테스트 클래스를 찾을 수 있다.
    *   그 클래스에서 적절한 테스트 메서드를 고를 수 있다.
    *   그 메서드에서 사용하는 객체의 생명주기를 이해할 수 있다.



## 2.3 엉뚱한 걸 검사하는 건 좋지 않다.

*   우리는 자신의 테스트를 신뢰 할 수 있어야 한다.
*   올바른 것을 검사하는 것 못지 않게 올바른 것을 똑바로 거사하는 것도 중요하다. 특히 유지 보수 관점에서는 어떻게 구현했느냐가 아니라 의도한 대로 구현했느냐를 검사하는게 중요하다.



## 2. 4 독립적인 테스트는 혼자서도 잘 실행된다.

*   격리와 독립성이 중요한 이유는 그것이 없다면 테스트를 실행하고 관리하기가 훨씬 어렵기 때문이다.
*   테스트 스위트 전체를 실행할 때는 아무 이상 없다가 하나만 따로 실행하면 실패하는 경우가 있다.
    *   상호 의존성이 있다는 강력한 징조이다.
*   실전에서 할 수 있는 방법들
    1.  테스트 더블로 서드파티 라이브러리와의 종속성을 제거한다.손수 만든 어댑터로 적절히 감싸준다.
    2.  테스트에 필요한 자원을 테스트 코드와 같은 위치에 둔다.
    3.  테스트가 사용할 자원을 직접 만들도록 한다.
    4.  테스트가 필요한 문맥을 직접설정하게 한다.
    5.  영속성이 필요한 통합 테스트라면, 인메모리 데이터베이스를 활용한다.
    6.  스레드를 사용하는 코드는 동기식과 비동기식을 구분 지어서 골치 아픈 동시성 문제는 소규모의 전문 테스트 그룹에 맡긴다.



## 2.5 믿음직한 테스트라야 기댈 수 있다.

*   실패하지 않는 테스트는 있느나 마나이다.
*   위와 같은 맥락으로 띄엄띄엄 성공하거나 띄엄띄엄 실패하는 테스트도 골치아픈 짐 덩어리이다.
*   테스트를 믿고 의지하려면 열번 실행하면 열 번 모두 반드시 같은 결과가 나와야 한다.
*   비동기적 요소나 현재 시각에 종속된 코드를 포함한다면, 그 부분을 인터페이스로 감싸 격리해야 한다.





## 2.6 모든 일이 그렇듯 테스트에도 도구가 쓰인다.

*   테스트 더블이란 테스트를 위해 실제 구현체와 교체할 수 있는 객체
    *   스텁
    *   가짜 객체
    *   Mock 객체
*   테스트 더블의 장점
    *   원래의 로직을 간소화된 코드로 대체하여 테스트 속도를 개선한다.
    *   만들어내기 어려운 특수한 상황을 시뮬레이션한다.
    *   대상 객체의 내부 상태나 동작 등 테스트가 접근할 수 없던 정보를 얻어낸다.



## 2.7 요약

1.  가독성
2.  잘 구조화된 테스트라면 원하는 코드를 빠르게 찾을 수 있고, 논리 흐름도 쉽게 이해할 수 있다.
3.  엉뚱한 걸 검사하는 테스트는 개발자를 잘못된 길로 안내하거나 본질을 흐려버려서 테스트가 의도했던 진짜 논리를 감추고 가독성을 떨어뜨린다.
4.  가끔 의심스러운 동작을 하는 테스트도 큰 문제이다.
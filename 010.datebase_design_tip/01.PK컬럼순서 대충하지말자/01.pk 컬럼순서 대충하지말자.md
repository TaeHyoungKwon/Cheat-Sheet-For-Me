# PK 컬럼순서, 대충하지 말자

## PK 구성과 인덱스 이용

* PK 값이 여러 컬럼이 합쳐져서 구성되는 경우에, Where 절에서, 일부 조건에 들어가게 되고, PK 순서가 제대로 안맞으면 풀스캔을 하게됨
  * ex)
    * 수험번호 + 년도 + 학기 순으로 컬럼 순서가 되어있고, 이때 where 절에서는 년도와 학기만 필터링 할 때, 컬럼 순서가 수험번호가 앞에 있기 때문에 풀스캔을 하게 된다.
* 풀스캔 하지 않도록 하려면, 년도 + 학기가 수험번호 보다 먼저 와야 한다.



## 인덱스의 비효율적 이용

* 거래일자 + 사무소 코드 순서로 인덱스가 구성된 경우 데이터 범위가 사무소 코드 + 거래일자 순서보다 더 넓어진다.
* 거래 일자는 between으로 범위를 검색하고, 사무소 코드는 = 으로 특정 코드에 대해서 검색을 하게 된다
* 그래서 사무소 코드로 먼저 조회하도록 하는 방법이 인덱스 스캔시 범위를 더 줄여서, 성능향상에 도움을 줄 수 있다.



## PK 컬럼 순서를 효율적으로 만드려면

* 설계 단계를 마치기 전 데이터 모델링을 수행할 때 PK 컬럼 순서를 반드시 검토해서 조정해야 한다.
* PK 순서가 잘못되어 SQL 문장의 성능이 저하되는 경우는 크게 2가지가 있다.
  * 첫번째 사례 처럼, 인덱스를 이용하지 못하고 Full table scan을 하는 경우
    * 이 경우에는 실행계획을 확인하고 튜닝을 할 수 있지만
  * 두번째 사례 처럼 인덱스는 이용하지만 범위가 넓어져 성능이 저하되는 경우
    * 인덱스를 이용하기 떄문에,  성능이 저하되는 경우에도 튜닝  해야할 필요성을 깨닫지 못하는 사례가 빈번
* 인덱스의 정렬 구조를 이해한 상태에서 트랜잭션의 특성에 따른 PK 구성을 하여 인덱스 범위를 최소화하는 방향을 ㅗ데이터 모델에 반영해야 한다.
* 여러 개의 속성이 하나의 인덱스로 구성되어 있을 때 앞쪽에 위치한 속성의 값이 비교자로 있어야 인덱스가 좋은 효율을 나타낼 수 있다.